<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:146.0) Gecko/20100101 Firefox/146.0" version="29.0.3" pages="11">
  <diagram name="第 1 页" id="D1RUgCIsTHPNFqiDUUMz">
    <mxGraphModel dx="989" dy="550" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="oIFlIRmIM43IfIDlkQ02-25" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="80" y="250" width="60" height="91.5" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-12" value="" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.bucket;fillColor=#E05243;gradientColor=none;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-25">
          <mxGeometry width="60" height="61.5" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-17" value="S3" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-25">
          <mxGeometry y="61.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-26" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="240" y="244.5" width="69" height="102" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-11" value="" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.lambda_function;fillColor=#F58534;gradientColor=none;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-26">
          <mxGeometry width="69" height="72" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-16" value="AWS lambda" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-26">
          <mxGeometry x="4.5" y="72" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-27" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="390" y="154.55" width="78" height="108" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-10" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.managed_streaming_for_kafka;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-27">
          <mxGeometry width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-14" value="Kafka" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-27">
          <mxGeometry x="8.5" y="78" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-28" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="390" y="320" width="78" height="108" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-13" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.managed_streaming_for_kafka;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-28">
          <mxGeometry width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-15" value="Kafka" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-28">
          <mxGeometry x="9" y="78" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-29" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="555" y="154.55" width="60" height="78" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="oIFlIRmIM43IfIDlkQ02-29">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="125" y="35.44999999999999" as="targetPoint" />
            <mxPoint x="65" y="34.44999999999999" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-6" value="" style="points=[];aspect=fixed;html=1;align=center;shadow=0;dashed=0;fillColor=#FF6A00;strokeColor=none;shape=mxgraph.alibaba_cloud.batchcompute;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-29">
          <mxGeometry x="6.600000000000023" width="46.800000000000004" height="48" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-7" value="vector" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-29">
          <mxGeometry y="48" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-30" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="680" y="143.60000000000002" width="60" height="88.94999999999999" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-9" value="" style="points=[];aspect=fixed;html=1;align=center;shadow=0;dashed=0;fillColor=#FF6A00;strokeColor=none;shape=mxgraph.alibaba_cloud.clickhouse;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-30">
          <mxGeometry x="6" width="48" height="54.900000000000006" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-18" value="Clickhouse" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-30">
          <mxGeometry y="58.94999999999999" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-31" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="546" y="320" width="78" height="108" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-19" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#ED7100;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.eks_cloud;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-31">
          <mxGeometry width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-20" value="Tencent publisher(EKS)" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-31">
          <mxGeometry x="9" y="78" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-32" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="681" y="320" width="78" height="108" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-21" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#C925D1;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.rds;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-32">
          <mxGeometry width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-22" value="RDS" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-32">
          <mxGeometry x="9" y="78" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-33" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="820" y="319.25" width="80" height="101.5" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-23" value="" style="shape=image;html=1;verticalAlign=top;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;imageAspect=0;aspect=fixed;image=https://cdn3.iconfinder.com/data/icons/social-media/512/QQ-128.png" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-33">
          <mxGeometry width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-24" value="Tencent" style="text;strokeColor=none;align=center;fillColor=none;html=1;verticalAlign=middle;whiteSpace=wrap;rounded=0;container=1;" vertex="1" parent="oIFlIRmIM43IfIDlkQ02-33">
          <mxGeometry x="10" y="71.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="oIFlIRmIM43IfIDlkQ02-12" target="oIFlIRmIM43IfIDlkQ02-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="oIFlIRmIM43IfIDlkQ02-11" target="oIFlIRmIM43IfIDlkQ02-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="oIFlIRmIM43IfIDlkQ02-11" target="oIFlIRmIM43IfIDlkQ02-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="oIFlIRmIM43IfIDlkQ02-10">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="560" y="194" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="oIFlIRmIM43IfIDlkQ02-13" target="oIFlIRmIM43IfIDlkQ02-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="oIFlIRmIM43IfIDlkQ02-19" target="oIFlIRmIM43IfIDlkQ02-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oIFlIRmIM43IfIDlkQ02-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="oIFlIRmIM43IfIDlkQ02-21" target="oIFlIRmIM43IfIDlkQ02-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="rfGW7l7K45J85RhH1_x_" name="第 2 页">
    <mxGraphModel dx="1570" dy="697" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="S-d44Twx8Tk8yZ1dI5Ju-2" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="230" y="360" width="1250" height="1020" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-99" value="Multi-CDN Traffic API 整合架構" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="640" y="390" width="430" height="40" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-100" value="客戶端層" style="swimlane;whiteSpace=wrap;html=1;fillColor=#E1F5FF;strokeColor=#0066CC;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="460" width="1000" height="120" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-101" value="抖音客戶&lt;br&gt;Domain: douyin.com" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;fontSize=12;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-100">
          <mxGeometry x="420" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-102" value="Mlytics Load Balancer" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FFF4E1;strokeColor=#FF9800;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="600" width="1000" height="120" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-103" value="Multi-CDN LB&lt;br&gt;智能調度" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE6B3;strokeColor=#FF9800;fontSize=12;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-102">
          <mxGeometry x="420" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-104" value="CDN 供應商" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FFE1E1;strokeColor=#FF0000;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="740" width="1000" height="120" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-105" value="Akamai CDN&lt;br&gt;Traffic API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCCCC;strokeColor=#FF0000;fontSize=12;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-104">
          <mxGeometry x="260" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-106" value="Tencent CDN&lt;br&gt;Traffic API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCCCC;strokeColor=#FF0000;fontSize=12;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-104">
          <mxGeometry x="580" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S-d44Twx8Tk8yZ1dI5Ju-4" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;fillColor=light-dark(#FFFFFF,#FF9999);" edge="1" parent="NWe40YDavx-3O5DiC_-B-104">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="499.76" y="110" as="sourcePoint" />
            <mxPoint x="499.76" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-107" value="Mlytics 數據處理層" style="swimlane;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="880" width="1000" height="320" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-108" value="API Gateway&lt;br&gt;統一入口" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCCCCC;strokeColor=#666666;fontSize=12;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-107">
          <mxGeometry x="420" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-112" value="數據轉換" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#FBC02D;fontSize=12;fontStyle=1" vertex="1" parent="NWe40YDavx-3O5DiC_-B-107">
          <mxGeometry x="380" y="120" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-113" value="Common Schema&lt;br&gt;Transformer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF59D;strokeColor=#FBC02D;fontSize=11;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-112">
          <mxGeometry x="40" y="35" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-116" value="API 服務" style="swimlane;whiteSpace=wrap;html=1;fillColor=#E1FFE1;strokeColor=#4CAF50;fontSize=12;fontStyle=1" vertex="1" parent="NWe40YDavx-3O5DiC_-B-107">
          <mxGeometry x="360" y="220" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-117" value="Multi-CDN Traffic API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#4CAF50;fontSize=11;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-116">
          <mxGeometry x="60" y="35" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-118" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#0066CC;" edge="1" parent="1" source="NWe40YDavx-3O5DiC_-B-101" target="NWe40YDavx-3O5DiC_-B-103">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-119" value="請求內容" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="NWe40YDavx-3O5DiC_-B-118">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-120" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#FF9800;" edge="1" parent="1" source="NWe40YDavx-3O5DiC_-B-103" target="NWe40YDavx-3O5DiC_-B-105">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-121" value="分流 50%" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="NWe40YDavx-3O5DiC_-B-120">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-122" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#FF9800;" edge="1" parent="1" source="NWe40YDavx-3O5DiC_-B-103" target="NWe40YDavx-3O5DiC_-B-106">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-123" value="分流 50%" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="NWe40YDavx-3O5DiC_-B-122">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-132" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#0066CC;dashed=1;" edge="1" parent="1" source="NWe40YDavx-3O5DiC_-B-101" target="NWe40YDavx-3O5DiC_-B-108">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1420" y="530" />
              <mxPoint x="1420" y="940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-133" value="查詢請求" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="NWe40YDavx-3O5DiC_-B-132">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-134" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#4CAF50;" edge="1" parent="1" source="NWe40YDavx-3O5DiC_-B-108" target="NWe40YDavx-3O5DiC_-B-117">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-137" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#4CAF50;dashed=1;" edge="1" parent="1" source="NWe40YDavx-3O5DiC_-B-117" target="NWe40YDavx-3O5DiC_-B-101">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="300" y="1140" />
              <mxPoint x="300" y="530" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-138" value="返回結果" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="NWe40YDavx-3O5DiC_-B-137">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-139" value="圖例" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="1220" width="300" height="120" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-140" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#0066CC;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-139">
          <mxGeometry x="20" y="35" width="60" height="10" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-141" value="內容分發流量" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-139">
          <mxGeometry x="90" y="30" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-142" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#4CAF50;dashed=1;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-139">
          <mxGeometry x="20" y="55" width="60" height="10" as="geometry" />
        </mxCell>
        <mxCell id="NWe40YDavx-3O5DiC_-B-143" value="數據收集" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="NWe40YDavx-3O5DiC_-B-139">
          <mxGeometry x="90" y="50" width="100" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="hzyi6LTajUh1b4SofJwb" name="第 3 页">
    <mxGraphModel dx="2015" dy="1139" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="fD0sr1mARC3nT6uKhoEN-1" value="Multi-CDN Traffic API 設計與數據模型" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="480" y="140" width="630" height="40" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-2" value="API 端點設計" style="swimlane;whiteSpace=wrap;html=1;fillColor=#E1F5FF;strokeColor=#0066CC;fontSize=14;fontStyle=1;startSize=40;" parent="1" vertex="1">
          <mxGeometry x="290" y="210" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-3" value="GET /api/v1/traffic/multi-cdn&lt;br&gt;&lt;br&gt;查詢多 CDN 聚合流量" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;fontSize=12;align=left;spacingLeft=10;spacingTop=5;" parent="fD0sr1mARC3nT6uKhoEN-2" vertex="1">
          <mxGeometry x="20" y="60" width="440" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-4" value="GET /api/v1/traffic/breakdown&lt;br&gt;&lt;br&gt;按 CDN 分解流量明細" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;fontSize=12;align=left;spacingLeft=10;spacingTop=5;" parent="fD0sr1mARC3nT6uKhoEN-2" vertex="1">
          <mxGeometry x="20" y="125" width="440" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-5" value="GET /api/v1/traffic/compare&lt;br&gt;&lt;br&gt;CDN 性能對比分析" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;fontSize=12;align=left;spacingLeft=10;spacingTop=5;" parent="fD0sr1mARC3nT6uKhoEN-2" vertex="1">
          <mxGeometry x="20" y="190" width="440" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-6" value="查詢參數" style="swimlane;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;fontSize=14;fontStyle=1;startSize=40;" parent="1" vertex="1">
          <mxGeometry x="810" y="210" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-7" value="&lt;b&gt;Parameters:&lt;/b&gt;&lt;br&gt;&lt;br&gt;• &lt;b&gt;domain&lt;/b&gt; (required): string&lt;br&gt;  域名，例如: douyin.com&lt;br&gt;&lt;br&gt;• &lt;b&gt;start_time&lt;/b&gt; (required): datetime&lt;br&gt;  開始時間 (ISO 8601 格式)&lt;br&gt;&lt;br&gt;• &lt;b&gt;end_time&lt;/b&gt; (required): datetime&lt;br&gt;  結束時間 (ISO 8601 格式)&lt;br&gt;&lt;br&gt;• &lt;b&gt;granularity&lt;/b&gt; (optional): enum&lt;br&gt;  時間粒度: 5min / 1hour / 1day&lt;br&gt;  預設值: 5min&lt;br&gt;&lt;br&gt;• &lt;b&gt;cdn_filter&lt;/b&gt; (optional): string&lt;br&gt;  CDN 篩選: akamai / tencent / all&lt;br&gt;  預設值: all" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#4CAF50;fontSize=11;align=left;verticalAlign=top;spacingLeft=15;spacingTop=10;" parent="fD0sr1mARC3nT6uKhoEN-6" vertex="1">
          <mxGeometry x="20" y="60" width="440" height="200" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-8" value="ClickHouse 數據模型" style="swimlane;whiteSpace=wrap;html=1;fillColor=#F0E1FF;strokeColor=#9C27B0;fontSize=14;fontStyle=1;startSize=40;" parent="1" vertex="1">
          <mxGeometry x="290" y="530" width="1000" height="320" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-9" value="multi_cdn_traffic (主表)" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#E1BEE7;strokeColor=#9C27B0;fontSize=12;" parent="fD0sr1mARC3nT6uKhoEN-8" vertex="1">
          <mxGeometry x="30" y="60" width="440" height="240" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-10" value="domain: String" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-9" vertex="1">
          <mxGeometry y="30" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-11" value="cdn_provider: String (akamai, tencent, cloudflare, ...)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-9" vertex="1">
          <mxGeometry y="56" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-12" value="timestamp: DateTime (時間戳記)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-9" vertex="1">
          <mxGeometry y="82" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-13" value="traffic_bytes: UInt64 (總流量，單位: bytes)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-9" vertex="1">
          <mxGeometry y="108" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-14" value="bandwidth_bps: UInt64 (峰值帶寬，單位: bps)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-9" vertex="1">
          <mxGeometry y="134" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-15" value="request_count: UInt64 (請求總數)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-9" vertex="1">
          <mxGeometry y="160" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-16" value="hit_rate: Float32 (快取命中率，0.0 - 1.0)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-9" vertex="1">
          <mxGeometry y="186" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-17" value="status_2xx, status_4xx, status_5xx: UInt32" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-9" vertex="1">
          <mxGeometry y="212" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-18" value="multi_cdn_traffic_agg (物化視圖)" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#FFF59D;strokeColor=#FBC02D;fontSize=12;" parent="fD0sr1mARC3nT6uKhoEN-8" vertex="1">
          <mxGeometry x="520" y="60" width="440" height="240" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-19" value="(預聚合，自動計算)" style="text;strokeColor=none;fillColor=#FFFFCC;align=center;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=10;fontStyle=2;" parent="fD0sr1mARC3nT6uKhoEN-18" vertex="1">
          <mxGeometry y="30" width="440" height="20" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-20" value="domain: String" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-18" vertex="1">
          <mxGeometry y="50" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-21" value="timestamp: DateTime" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;" parent="fD0sr1mARC3nT6uKhoEN-18" vertex="1">
          <mxGeometry y="76" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-22" value="total_traffic: UInt64 = sum(traffic_bytes)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;fontStyle=1" parent="fD0sr1mARC3nT6uKhoEN-18" vertex="1">
          <mxGeometry y="102" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-23" value="total_requests: UInt64 = sum(request_count)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;fontStyle=1" parent="fD0sr1mARC3nT6uKhoEN-18" vertex="1">
          <mxGeometry y="128" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-24" value="avg_hit_rate: Float32 = avg(hit_rate)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=11;fontStyle=1" parent="fD0sr1mARC3nT6uKhoEN-18" vertex="1">
          <mxGeometry y="154" width="440" height="26" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-25" value="註: 此表自動從主表聚合數據，提升查詢效率" style="text;strokeColor=none;fillColor=#FFFFCC;align=left;verticalAlign=top;spacingLeft=10;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=10;fontStyle=2;" parent="fD0sr1mARC3nT6uKhoEN-18" vertex="1">
          <mxGeometry y="180" width="440" height="40" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-26" value="API 響應格式" style="swimlane;whiteSpace=wrap;html=1;fillColor=#E1FFE1;strokeColor=#4CAF50;fontSize=14;fontStyle=1;startSize=40;" parent="1" vertex="1">
          <mxGeometry x="290" y="890" width="1000" height="360" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-27" value="&lt;font style=&quot;font-size: 10px;&quot; face=&quot;Courier New&quot;&gt;{&lt;br&gt;  &quot;domain&quot;: &quot;douyin.com&quot;,&lt;br&gt;  &quot;time_range&quot;: {&lt;br&gt;    &quot;start&quot;: &quot;2025-10-14T00:00:00Z&quot;,&lt;br&gt;    &quot;end&quot;: &quot;2025-10-14T23:59:59Z&quot;&lt;br&gt;  },&lt;br&gt;  &quot;total_traffic_gb&quot;: 1200,&lt;br&gt;  &quot;cdn_breakdown&quot;: {&lt;br&gt;    &quot;akamai&quot;: {&lt;br&gt;      &quot;traffic_gb&quot;: 600,&lt;br&gt;      &quot;percentage&quot;: 50,&lt;br&gt;      &quot;avg_bandwidth_gbps&quot;: 1.5,&lt;br&gt;      &quot;avg_hit_rate&quot;: 0.95&lt;br&gt;    },&lt;br&gt;    &quot;tencent&quot;: {&lt;br&gt;      &quot;traffic_gb&quot;: 600,&lt;br&gt;      &quot;percentage&quot;: 50,&lt;br&gt;      &quot;avg_bandwidth_gbps&quot;: 1.5,&lt;br&gt;      &quot;avg_hit_rate&quot;: 0.93&lt;br&gt;    }&lt;br&gt;  },&lt;br&gt;  &quot;timeseries&quot;: [&lt;br&gt;    {&lt;br&gt;      &quot;timestamp&quot;: &quot;2025-10-14T00:00:00Z&quot;,&lt;br&gt;      &quot;total_traffic_mb&quot;: 50000,&lt;br&gt;      &quot;akamai_traffic_mb&quot;: 25000,&lt;br&gt;      &quot;tencent_traffic_mb&quot;: 25000&lt;br&gt;    },&lt;br&gt;    ...&lt;br&gt;  ]&lt;br&gt;}&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#4CAF50;fontSize=10;align=left;verticalAlign=top;spacingLeft=15;spacingTop=10;fontFamily=Courier New;" parent="fD0sr1mARC3nT6uKhoEN-26" vertex="1">
          <mxGeometry x="30" y="60" width="940" height="280" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#0066CC;dashed=1;" parent="1" source="fD0sr1mARC3nT6uKhoEN-2" target="fD0sr1mARC3nT6uKhoEN-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-29" value="使用參數" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;backgroundColor=#FFFFFF;" parent="fD0sr1mARC3nT6uKhoEN-28" vertex="1" connectable="0">
          <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9C27B0;" parent="1" source="fD0sr1mARC3nT6uKhoEN-6" target="fD0sr1mARC3nT6uKhoEN-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1050" y="510" />
              <mxPoint x="510" y="510" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-31" value="查詢主表" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;backgroundColor=#FFFFFF;" parent="fD0sr1mARC3nT6uKhoEN-30" vertex="1" connectable="0">
          <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
            <mxPoint x="-90" y="-8" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#FBC02D;dashed=1;" parent="1" source="fD0sr1mARC3nT6uKhoEN-9" target="fD0sr1mARC3nT6uKhoEN-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-33" value="自動聚合" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;backgroundColor=#FFFFFF;" parent="fD0sr1mARC3nT6uKhoEN-32" vertex="1" connectable="0">
          <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#4CAF50;" parent="1" source="fD0sr1mARC3nT6uKhoEN-18" target="fD0sr1mARC3nT6uKhoEN-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1000" y="870" />
              <mxPoint x="790" y="870" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fD0sr1mARC3nT6uKhoEN-35" value="格式化輸出" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;backgroundColor=#FFFFFF;" parent="fD0sr1mARC3nT6uKhoEN-34" vertex="1" connectable="0">
          <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
            <mxPoint x="35" y="-8" as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="vwazhwXaMmM0AAaGhuV7" name="cachefly">
    <mxGraphModel dx="1390" dy="786" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="lm9oKPD17I8IJrIdRi_8-195" value="&lt;b style=&#39;font-size: 24px&#39;&gt;������ Cachefly CDN 集成專案時程 (6週快速版)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4d90fe;strokeColor=#1a5fb4;fontColor=#ffffff;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="390" y="200" width="600" height="50" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-196" value="&lt;b&gt;圖例:&lt;/b&gt; ������階段 ������進行中 ������開發中 ������測試中 ������里程碑" style="text;html=1;strokeColor=none;fillColor=none;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="140" y="270" width="400" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-197" value="&lt;b&gt;������ Phase 1: 需求+設計+環境 (2週)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4d90fe;strokeColor=#1a5fb4;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="140" y="310" width="1100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-198" value="&lt;b&gt;1.1 需求分析 (含商務)&lt;/b&gt;&lt;br&gt;������ 11/03-11/11 (7天)&lt;br&gt;������ 龍哥" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="140" y="360" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-199" value="&lt;b&gt;1.2 系統設計&lt;/b&gt;&lt;br&gt;������ 11/04-11/12 (7天)&lt;br&gt;������ Henry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="410" y="360" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-200" value="&lt;b&gt;1.3 環境準備&lt;/b&gt;&lt;br&gt;������ 11/05-11/14 (8天)&lt;br&gt;������ 團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="680" y="360" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-201" value="&lt;b&gt;������ M1: 需求評審通過&lt;/b&gt;&lt;br&gt;������ 11/14" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5a6bd;strokeColor=#a64d79;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="950" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-202" value="&lt;b&gt;������ Phase 2: 開發階段 (高度並行) (2週)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4d90fe;strokeColor=#1a5fb4;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="140" y="460" width="1100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-203" value="&lt;b&gt;2.1 格式轉換規則&lt;/b&gt;&lt;br&gt;������ 11/17-11/26 (8天)&lt;br&gt;������ 龍哥" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c9daf8;strokeColor=#6d9eeb;" vertex="1" parent="1">
          <mxGeometry x="140" y="510" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-204" value="&lt;b&gt;2.2 S3 拉取模組&lt;/b&gt;&lt;br&gt;������ 11/17-11/26 (8天)&lt;br&gt;������ Henry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c9daf8;strokeColor=#6d9eeb;" vertex="1" parent="1">
          <mxGeometry x="410" y="510" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-205" value="&lt;b&gt;2.3 Log Processor 集成&lt;/b&gt;&lt;br&gt;������ 11/24-11/27 (4天)&lt;br&gt;������ 團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c9daf8;strokeColor=#6d9eeb;" vertex="1" parent="1">
          <mxGeometry x="680" y="510" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-206" value="&lt;b&gt;2.4 文檔快速版&lt;/b&gt;&lt;br&gt;������ 11/27-11/28 (2天)&lt;br&gt;������ 團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c9daf8;strokeColor=#6d9eeb;" vertex="1" parent="1">
          <mxGeometry x="950" y="510" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-207" value="&lt;b&gt;������ M2: 開發完成&lt;/b&gt;&lt;br&gt;������ 11/28" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5a6bd;strokeColor=#a64d79;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1170" y="510" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-208" value="&lt;b&gt;������ Phase 3: QA 測試與修正 (1週)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4d90fe;strokeColor=#1a5fb4;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="140" y="610" width="1100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-209" value="&lt;b&gt;3.1 單元測試驗證&lt;/b&gt;&lt;br&gt;������ 12/01-12/02 (2天)&lt;br&gt;������ QA團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ea9999;strokeColor=#cc4125;" vertex="1" parent="1">
          <mxGeometry x="140" y="660" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-210" value="&lt;b&gt;3.2 集成測試&lt;/b&gt;&lt;br&gt;������ 12/02-12/04 (3天)&lt;br&gt;������ QA團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ea9999;strokeColor=#cc4125;" vertex="1" parent="1">
          <mxGeometry x="410" y="660" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-211" value="&lt;b&gt;3.3 效能測試&lt;/b&gt;&lt;br&gt;������ 12/03-12/05 (3天)&lt;br&gt;������ QA團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ea9999;strokeColor=#cc4125;" vertex="1" parent="1">
          <mxGeometry x="680" y="660" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-212" value="&lt;b&gt;3.4 開發修正 (並行)&lt;/b&gt;&lt;br&gt;������ 12/01-12/05 (5天)&lt;br&gt;������ 開發團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ea9999;strokeColor=#cc4125;" vertex="1" parent="1">
          <mxGeometry x="950" y="660" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-213" value="&lt;b&gt;������ M3: 測試驗證通過&lt;/b&gt;&lt;br&gt;������ 12/05" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5a6bd;strokeColor=#a64d79;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1220" y="660" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-214" value="&lt;b&gt;������ Phase 4: 部署上線 (1週)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4d90fe;strokeColor=#1a5fb4;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="140" y="760" width="1100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-215" value="&lt;b&gt;4.1 生產環境準備&lt;/b&gt;&lt;br&gt;������ 12/08-12/09 (2天)&lt;br&gt;������ 運維團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b6d7a8;strokeColor=#6aa84f;" vertex="1" parent="1">
          <mxGeometry x="140" y="810" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-216" value="&lt;b&gt;4.2 上線驗證&lt;/b&gt;&lt;br&gt;������ 12/09-12/10 (2天)&lt;br&gt;������ 團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b6d7a8;strokeColor=#6aa84f;" vertex="1" parent="1">
          <mxGeometry x="410" y="810" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-217" value="&lt;b&gt;4.3 監控告警配置&lt;/b&gt;&lt;br&gt;������ 12/10-12/11 (2天)&lt;br&gt;������ 運維團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b6d7a8;strokeColor=#6aa84f;" vertex="1" parent="1">
          <mxGeometry x="680" y="810" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-218" value="&lt;b&gt;4.4 最終文檔&lt;/b&gt;&lt;br&gt;������ 12/11-12/12 (2天)&lt;br&gt;������ 團隊" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b6d7a8;strokeColor=#6aa84f;" vertex="1" parent="1">
          <mxGeometry x="950" y="810" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-219" value="&lt;b&gt;4.5 專案總結&lt;/b&gt;&lt;br&gt;������ 12/12&lt;br&gt;������ PM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b6d7a8;strokeColor=#6aa84f;" vertex="1" parent="1">
          <mxGeometry x="1220" y="810" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-220" value="&lt;b&gt;������ M4: 生產上線完成&lt;/b&gt;&lt;br&gt;������ 12/15&lt;br&gt;✅ 專案完成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd966;strokeColor=#bf9000;fontColor=#000000;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="590" y="910" width="300" height="70" as="geometry" />
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-221" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=0;exitX=0.5;exitY=1;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="lm9oKPD17I8IJrIdRi_8-197" target="lm9oKPD17I8IJrIdRi_8-202">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="690" y="460" as="sourcePoint" />
            <mxPoint x="740" y="410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-222" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=0;exitX=0.5;exitY=1;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="lm9oKPD17I8IJrIdRi_8-202" target="lm9oKPD17I8IJrIdRi_8-208">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="690" y="610" as="sourcePoint" />
            <mxPoint x="740" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="lm9oKPD17I8IJrIdRi_8-223" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=0;exitX=0.5;exitY=1;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1" source="lm9oKPD17I8IJrIdRi_8-208" target="lm9oKPD17I8IJrIdRi_8-214">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="690" y="760" as="sourcePoint" />
            <mxPoint x="740" y="710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="uKgbgpOgVa1xG_5K2Gzh" name="第 5 页">
    <mxGraphModel dx="3700" dy="1782" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="主要排查流程" id="BP7RFHOilDS_j5BAm3M7">
    <mxGraphModel dx="1884" dy="836" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="1654" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="start" value="Zabbix 監控發現&#xa;14:46 有 30+ 個 500 錯誤" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff6b6b;strokeColor=#b85450;fontColor=#ffffff;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="480" y="40" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="check-gateway" value="檢查 Gateway Log&#xa;Traefik/Loki" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13" parent="1" vertex="1">
          <mxGeometry x="480" y="160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="start" target="check-gateway" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="gateway-decision" value="Gateway Log&#xa;有 5xx access log?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13" parent="1" vertex="1">
          <mxGeometry x="460" y="260" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="arrow2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="check-gateway" target="gateway-decision" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="analyze-gateway" value="分析 Gateway 5xx" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13" parent="1" vertex="1">
          <mxGeometry x="240" y="400" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow3" value="找到 5xx" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="gateway-decision" target="analyze-gateway" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="no-match" value="❌ 時間對不上!&#xa;Gateway 都是 200" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffd93d;strokeColor=#d6b656;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="720" y="380" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow4" value="只有 200" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="gateway-decision" target="no-match" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="gateway-error-type" value="5xx 類型?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13" parent="1" vertex="1">
          <mxGeometry x="220" y="500" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="analyze-gateway" target="gateway-error-type" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="error-502" value="502 Bad Gateway&#xa;後端服務不可用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="40" y="640" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="error-503" value="503 Service Unavailable&#xa;服務過載/熔斷" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="200" y="640" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="error-504" value="504 Gateway Timeout&#xa;後端回應超時" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="360" y="640" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="error-500" value="500 Internal Error&#xa;Gateway 配置錯誤" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="520" y="640" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow6" value="502" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="gateway-error-type" target="error-502" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow7" value="503" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="gateway-error-type" target="error-503" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow8" value="504" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="gateway-error-type" target="error-504" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow9" value="500" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="gateway-error-type" target="error-500" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="multi-pod" value="是否有多個&#xa;Traefik Pod?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13" parent="1" vertex="1">
          <mxGeometry x="700" y="500" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="no-match" target="multi-pod" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="check-other-pods" value="查詢其他 Pod 的 log&#xa;可能錯誤在別的 Pod" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="720" y="640" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow11" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="multi-pod" target="check-other-pods" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="check-backend" value="檢查後端服務 log&#xa;http://10.24.8.111:80" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="1040" y="640" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow12" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="multi-pod" target="check-backend" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="other-pod-result" value="其他 Pod&#xa;有 5xx?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13" parent="1" vertex="1">
          <mxGeometry x="700" y="740" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="check-other-pods" target="other-pod-result" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow14" value="有" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="other-pod-result" target="analyze-gateway" edge="1">
          <mxGeometry x="-0.8154" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="510" y="780" />
              <mxPoint x="510" y="430" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow15" value="沒有" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="other-pod-result" target="check-backend" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="980" y="780" />
              <mxPoint x="980" y="670" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="backend-result" value="後端 log&#xa;有 5xx 錯誤?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=13" parent="1" vertex="1">
          <mxGeometry x="1020" y="760" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="check-backend" target="backend-result" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="backend-issue" value="������ 問題在後端服務&#xa;Gateway 只是轉發" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6bcf7f;strokeColor=#82b366;fontColor=#ffffff;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="1040" y="900" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow17" value="有" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="backend-result" target="backend-issue" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mystery" value="❓ 無法定位&#xa;需要加入 Trace ID" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff6b6b;strokeColor=#b85450;fontColor=#ffffff;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="860" y="900" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow18" value="沒有" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="backend-result" target="mystery" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="add-trace" value="建議: 加入分散式追蹤&#xa;(Request ID / Trace ID)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4ecdc4;strokeColor=#0e8088;fontColor=#ffffff;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="840" y="1000" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="mystery" target="add-trace" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="noop-error" value="發現: noop@internal 錯誤" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="500" y="380" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="arrow20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;dashPattern=8 8;" parent="1" source="check-gateway" target="noop-error" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="720" y="190" />
              <mxPoint x="720" y="240" />
              <mxPoint x="450" y="240" />
              <mxPoint x="450" y="400" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="noop-analysis" value="noop 錯誤&#xa;影響請求嗎?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="230" y="100" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="noop-error" target="noop-analysis" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="580" y="370" />
              <mxPoint x="390" y="370" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fix-noop" value="修復 IngressRoute 配置" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="120" y="260" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cleanup-later" value="記錄為技術債&#xa;之後清理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12" parent="1" vertex="1">
          <mxGeometry x="120" y="360" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="arrow22" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="noop-analysis" target="fix-noop" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="270" y="180" />
              <mxPoint x="270" y="225" />
              <mxPoint x="180" y="225" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow23" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" parent="1" source="noop-analysis" target="cleanup-later" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="310" y="320" />
              <mxPoint x="180" y="320" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="title" value="C2G API 5xx 錯誤排查流程圖" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="390" width="400" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#666666;dashed=1;dashPattern=8 8;" parent="1" vertex="1">
          <mxGeometry x="40" y="40" width="160" height="140" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="圖例" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="50" y="50" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-1" value="起始/問題" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff6b6b;strokeColor=#b85450;fontColor=#ffffff;fontSize=11" parent="1" vertex="1">
          <mxGeometry x="50" y="75" width="140" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend-2" value="處理步驟" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11" parent="1" vertex="1">
          <mxGeometry x="50" y="95" width="140" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend-3" value="決策點" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" parent="1" vertex="1">
          <mxGeometry x="50" y="115" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-4" value="成功/解決" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6bcf7f;strokeColor=#82b366;fontColor=#ffffff;fontSize=11" parent="1" vertex="1">
          <mxGeometry x="50" y="140" width="140" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend-5" value="警告/待定" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffd93d;strokeColor=#d6b656;fontSize=11" parent="1" vertex="1">
          <mxGeometry x="50" y="160" width="140" height="15" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="當前狀態圖" id="yUaOWR2FgNASUtTCCC4W">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <!-- 標題 -->
        <mxCell id="title2" value="當前問題狀態 - 無法追蹤請求路徑" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="40" width="500" height="30" as="geometry" />
        </mxCell>
        <!-- Zabbix -->
        <mxCell id="zabbix" value="Zabbix 監控" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff6b6b;strokeColor=#b85450;fontColor=#ffffff;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="120" y="150" width="160" height="80" as="geometry" />
        </mxCell>
        <!-- Gateway -->
        <mxCell id="gateway2" value="Gateway (Traefik)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="440" y="150" width="160" height="80" as="geometry" />
        </mxCell>
        <!-- Backend -->
        <mxCell id="backend2" value="Backend 服務&#xa;10.24.8.111:80" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="760" y="150" width="160" height="80" as="geometry" />
        </mxCell>
        <!-- 箭頭和說明 -->
        <mxCell id="arrow2-1" value="報告 5xx" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#ff6b6b;strokeWidth=3;" edge="1" parent="1" source="zabbix" target="gateway2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-2" value="應該轉發到" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=2;" edge="1" parent="1" source="gateway2" target="backend2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <!-- 查詢結果 -->
        <mxCell id="zabbix-result" value="✓ 明確: 14:46 有 500" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="120" y="270" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="gateway-result" value="? 查詢 Loki&#xa;只看到 200 和 noop 錯誤" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffd93d;strokeColor=#d6b656;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="440" y="270" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="backend-result2" value="✗ 沒權限查看 log" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="760" y="270" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="zabbix" target="zabbix-result">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="gateway2" target="gateway-result">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="backend2" target="backend-result2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <!-- 問題總結 -->
        <mxCell id="problem-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="120" y="380" width="800" height="180" as="geometry" />
        </mxCell>
        <mxCell id="problem-title" value="⚠️ 核心問題" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="140" y="390" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="problem-1" value="❌ 無法對應: Zabbix 的 5xx 和 Gateway log 對不上" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13" vertex="1" parent="1">
          <mxGeometry x="140" y="425" width="740" height="25" as="geometry" />
        </mxCell>
        <mxCell id="problem-2" value="❌ 時間不精確: 只能靠時間戳對比，14:46 這一分鐘有上百個請求" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13" vertex="1" parent="1">
          <mxGeometry x="140" y="455" width="740" height="25" as="geometry" />
        </mxCell>
        <mxCell id="problem-3" value="❌ 缺少追蹤: 沒有 Request ID / Trace ID 來串連整條鏈路" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13" vertex="1" parent="1">
          <mxGeometry x="140" y="485" width="740" height="25" as="geometry" />
        </mxCell>
        <mxCell id="problem-4" value="❌ 權限限制: 無法查看後端服務日誌" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13" vertex="1" parent="1">
          <mxGeometry x="140" y="515" width="740" height="25" as="geometry" />
        </mxCell>
        <!-- 結論 -->
        <mxCell id="conclusion" value="������ 結論: 無法定位問題根源，需要加入 Request ID 追蹤系統" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4ecdc4;strokeColor=#0e8088;fontColor=#ffffff;fontSize=15;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="200" y="620" width="640" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Trace ID 重要性" id="M_pCLrqXFOQU4Y9oKStK">
    <mxGraphModel dx="1426" dy="802" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title3" value="為什麼需要 Trace ID / Request ID ?" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="300" y="40" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="without-title" value="❌ 沒有 Trace ID（當前狀況）" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fillColor=#f8cecc;" parent="1" vertex="1">
          <mxGeometry x="120" y="100" width="400" height="30" as="geometry" />
        </mxCell>
        <mxCell id="without-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff4f4;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="120" y="140" width="880" height="350" as="geometry" />
        </mxCell>
        <mxCell id="w-zabbix" value="Zabbix" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff6b6b;strokeColor=#b85450;fontColor=#ffffff;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="160" y="180" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="w-zabbix-log" value="14:46:42 說有 500 錯誤" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=11;align=left" parent="1" vertex="1">
          <mxGeometry x="160" y="240" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w-zabbix" target="w-zabbix-log" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w-gateway" value="Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="400" y="180" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="w-gateway-log" value="14:46:42 ~ 14:46:59&#xa;有 100 個請求&#xa;都是 200 OK" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=11;align=left" parent="1" vertex="1">
          <mxGeometry x="400" y="240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w-gateway" target="w-gateway-log" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w-backend" value="Backend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="640" y="180" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="w-backend-log" value="看不到 log&#xa;(沒權限)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=center" parent="1" vertex="1">
          <mxGeometry x="640" y="240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w-backend" target="w-backend-log" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w-problem" value="❓ 哪一個才是 Zabbix 說的那個 500?" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd93d;strokeColor=#d6b656;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="160" y="340" width="600" height="50" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" parent="1" source="w-zabbix-log" target="w-problem" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" parent="1" source="w-gateway-log" target="w-problem" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="w-conclusion" value="❌ 無法確定問題在哪裡！" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff6b6b;strokeColor=#b85450;fontColor=#ffffff;fontSize=15;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="160" y="420" width="600" height="50" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#ff6b6b;" parent="1" source="w-problem" target="w-conclusion" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="with-title" value="✅ 有 Trace ID（建議實施）" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fillColor=#d5e8d4;" parent="1" vertex="1">
          <mxGeometry x="120" y="530" width="400" height="30" as="geometry" />
        </mxCell>
        <mxCell id="with-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f4fff4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="120" y="570" width="880" height="400" as="geometry" />
        </mxCell>
        <mxCell id="id-zabbix" value="Zabbix" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff6b6b;strokeColor=#b85450;fontColor=#ffffff;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="160" y="610" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="id-zabbix-log" value="[req-abc123]&#xa;14:46:42.100&#xa;發送請求 → 收到 500" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=11;align=left" parent="1" vertex="1">
          <mxGeometry x="160" y="670" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="id-zabbix" target="id-zabbix-log" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="id-gateway" value="Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="400" y="610" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="id-gateway-log" value="[req-abc123]&#xa;14:46:42.105&#xa;收到請求 → 轉發" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=11;align=left" parent="1" vertex="1">
          <mxGeometry x="400" y="670" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="id-gateway" target="id-gateway-log" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="id-backend" value="Backend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="640" y="610" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="id-backend-log" value="[req-abc123]&#xa;14:46:42.110&#xa;500 Error&#xa;DB timeout!" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=11;align=left" parent="1" vertex="1">
          <mxGeometry x="640" y="670" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="id-backend" target="id-backend-log" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="trace-line" value="������ 用 req-abc123 串起整條鏈路" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4ecdc4;strokeColor=#0e8088;fontColor=#ffffff;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="160" y="780" width="600" height="50" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#4ecdc4;" parent="1" source="id-zabbix-log" target="trace-line" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#4ecdc4;" parent="1" source="id-gateway-log" target="trace-line" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#4ecdc4;" parent="1" source="id-backend-log" target="trace-line" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="id-conclusion" value="������ 一眼就能看出: 問題在 Backend 的 Database timeout！" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6bcf7f;strokeColor=#82b366;fontColor=#ffffff;fontSize=15;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="160" y="870" width="600" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#6bcf7f;" parent="1" source="trace-line" target="id-conclusion" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="compare-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="120" y="1020" width="880" height="120" as="geometry" />
        </mxCell>
        <mxCell id="compare-title" value="������ 對比總結" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="140" y="1030" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="compare-1" value="❌ 沒有 Trace ID: 像瞎子摸象，只能猜測，浪費大量排查時間" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14" parent="1" vertex="1">
          <mxGeometry x="140" y="1065" width="740" height="25" as="geometry" />
        </mxCell>
        <mxCell id="compare-2" value="✅ 有 Trace ID: 像有 GPS 導航，精確定位問題，節省 80% 排查時間" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14" parent="1" vertex="1">
          <mxGeometry x="140" y="1095" width="740" height="25" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="方案一-SQS分流方案(已否決)" id="xevsGTucaQ8q6XOWv17Q">
    <mxGraphModel dx="1188" dy="668" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title1" value="方案一：SQS 分流方案（已否決）" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="400" y="20" width="400" height="40" as="geometry" />
        </mxCell>
        <mxCell id="warning1" value="⚠️ 此方案已被否決 - 架構複雜、單點故障風險、無法精準控制流量" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="300" y="70" width="600" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cdn1-1" value="火山 CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="80" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn1-2" value="GCore CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="220" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn1-3" value="Akamai CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="360" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn1-4" value="其他 CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="500" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s3-1" value="AWS S3 Bucket&#xa;(CDN Logs)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="250" y="270" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="cdn1-1" target="s3-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="cdn1-2" target="s3-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="cdn1-3" target="s3-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="cdn1-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="350" y="270" as="targetPoint" />
            <Array as="points">
              <mxPoint x="560" y="240" />
              <mxPoint x="350" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sqs-a1" value="SQS Queue A1&#xa;(Original)&#xa;⚠️ 單點故障風險" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="250" y="390" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="s3-1" target="sqs-a1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label1-1" value="S3 Event Notification" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow1-5" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="router1" value="分流服務&#xa;(成都新開發)&#xa;部署在 K8S" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="250" y="530" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="sqs-a1" target="router1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label1-2" value="消費訊息" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow1-6" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sqs-b1" value="SQS Queue B1&#xa;(給舊版 Log Processor)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="80" y="670" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sqs-b2" value="SQS Queue B2&#xa;(給新版 Bloom Filter)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="420" y="670" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#ff0000;" parent="1" source="router1" target="sqs-b1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label1-3" value="分流（全量複製）" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#ff0000;fontStyle=1" parent="arrow1-7" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="-40" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow1-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#ff0000;" parent="1" source="router1" target="sqs-b2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label1-4" value="分流（全量複製）" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#ff0000;fontStyle=1" parent="arrow1-8" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="40" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="old-processor1" value="舊版 Log Processor&#xa;(Golang)&#xa;使用舊版 Redis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="50" y="780" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="new-processor1" value="新版 Log Processor&#xa;(Golang + Bloom Filter)&#xa;使用 Valkey 8.1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="390" y="780" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="sqs-b1" target="old-processor1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="sqs-b2" target="new-processor1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="clickhouse1" value="ClickHouse&#xa;(Analytics Database)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="220" y="920" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="old-processor1" target="clickhouse1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="new-processor1" target="clickhouse1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="problem1-1" value="問題 1: A1 掛掉全部中斷" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="700" y="410" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="problem1-2" value="問題 2: 不是真正的分流&#xa;是全量複製，無法控制比例" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="700" y="540" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="problem1-3" value="問題 3: 架構複雜&#xa;需維護額外的分流服務" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="700" y="650" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="problem1-4" value="問題 4: Rollback 策略不明確&#xa;不知道要相信哪邊的資料" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="700" y="780" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="prob-arrow1-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#ff0000;strokeWidth=2;dashed=1;" parent="1" source="sqs-a1" target="problem1-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prob-arrow1-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#ff0000;strokeWidth=2;dashed=1;" parent="1" source="router1" target="problem1-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="方案二-Pod數量控制方案" id="Xc2euTMV4jbmfsWaWTnU">
    <mxGraphModel dx="1426" dy="802" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title2" value="方案二：Pod 數量控制方案 (Tim 提案)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="350" y="20" width="500" height="40" as="geometry" />
        </mxCell>
        <mxCell id="status2" value="✅ 快速實現 | ⚠️ 去重短期失效 | 適合時程緊急情況" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="300" y="70" width="600" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cdn2-1" value="火山 CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="80" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn2-2" value="GCore CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="220" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn2-3" value="Akamai CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="360" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn2-4" value="其他 CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="500" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s3-2" value="AWS S3 Bucket&#xa;(CDN Logs)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="250" y="270" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="cdn2-1" target="s3-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="140" y="240" />
              <mxPoint x="350" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow2-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="cdn2-2" target="s3-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="cdn2-3" target="s3-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="cdn2-4" target="s3-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="560" y="240" />
              <mxPoint x="350" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sqs2" value="SQS Queue&#xa;(單一 Queue)&#xa;✅ 維持原有架構" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="225" y="390" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="s3-2" target="sqs2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="compete2" value="兩組 Pods 競爭消費同一個 Queue" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="210" y="530" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="old-pods2" value="舊版 Log Processor Pods&#xa;(KEDA min replica = 5)&#xa;使用舊版 Redis&#xa;&#xa;Pod 1 | Pod 2 | Pod 3 | Pod 4 | Pod 5" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="620" width="280" height="110" as="geometry" />
        </mxCell>
        <mxCell id="new-pods2" value="新版 Log Processor Pod&#xa;(只開 1 台測試)&#xa;使用 Valkey 8.1 + Bloom Filter&#xa;&#xa;Pod 1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="420" y="620" width="280" height="110" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#009900;" parent="1" source="sqs2" target="old-pods2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="350" y="500" />
              <mxPoint x="190" y="500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="label2-1" value="約 83% 流量&#xa;(5/6)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontStyle=1;fontColor=#009900;" parent="arrow2-6" vertex="1" connectable="0">
          <mxGeometry x="-0.3" y="2" relative="1" as="geometry">
            <mxPoint x="-30" y="2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow2-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#0066cc;" parent="1" source="sqs2" target="new-pods2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="350" y="500" />
              <mxPoint x="560" y="500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="label2-2" value="約 17% 流量&#xa;(1/6)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontStyle=1;fontColor=#0066cc;" parent="arrow2-7" vertex="1" connectable="0">
          <mxGeometry x="-0.3" y="2" relative="1" as="geometry">
            <mxPoint x="35" y="2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="old-redis2" value="舊版 Redis&#xa;(原有 data structure)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="80" y="780" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="new-redis2" value="新版 Redis&#xa;(Valkey 8.1 + Bloom Filter)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="450" y="780" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="old-pods2" target="old-redis2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label2-3" value="去重" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow2-8" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow2-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="new-pods2" target="new-redis2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label2-4" value="去重" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow2-9" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="clickhouse2" value="ClickHouse&#xa;(Analytics Database)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="220" y="900" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="old-redis2" target="clickhouse2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="new-redis2" target="clickhouse2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="warning2-1" value="⚠️ 主要風險：兩組 Redis 無法 Global 去重&#xa;可能導致同一筆 log 被處理兩次" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="750" y="670" width="300" height="60" as="geometry" />
        </mxCell>
        <mxCell id="adv2" value="✅ 優點&#xa;• 實作快速&#xa;• 不需開發新功能&#xa;• 架構簡單&#xa;• 可隨時調整 pod 數量" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;" parent="1" vertex="1">
          <mxGeometry x="750" y="400" width="280" height="100" as="geometry" />
        </mxCell>
        <mxCell id="risk2" value="⚠️ 風險&#xa;• 短期去重失效&#xa;• 流量比例不精確 (受 KEDA 影響)&#xa;• 需監控重複率變化" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" parent="1" vertex="1">
          <mxGeometry x="750" y="520" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="recommend2" value=" 建議&#xa;• 適合時程緊急的情況&#xa;• 需設定監控告警&#xa;• 定義可接受的重複率閾值 (&lt;5%)&#xa;• 觀察 1-2 週後評估是否切換到方案三" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" parent="1" vertex="1">
          <mxGeometry x="750" y="780" width="300" height="110" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="方案三-Feature Flag方案" id="aLnXyctakhGCfeOyVpZV">
    <mxGraphModel dx="1426" dy="802" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title3" value="方案三：Feature Flag 方案 (Okis 推薦)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="350" y="20" width="500" height="40" as="geometry" />
        </mxCell>
        <mxCell id="status3" value=" 最佳方案 | ✅ 精準控制 | ✅ 快速 Rollback | ✅ 符合最佳實踐" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="250" y="70" width="700" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cdn3-1" value="火山 CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="80" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn3-2" value="GCore CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="220" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn3-3" value="Akamai CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="360" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cdn3-4" value="其他 CDN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="500" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="s3-3" value="AWS S3 Bucket&#xa;(CDN Logs)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="250" y="270" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="cdn3-1" target="s3-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="140" y="240" />
              <mxPoint x="350" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow3-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="cdn3-2" target="s3-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="cdn3-3" target="s3-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="cdn3-4" target="s3-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="560" y="240" />
              <mxPoint x="350" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sqs3" value="SQS Queue&#xa;(單一 Queue)&#xa;✅ 維持原有架構" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="225" y="390" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="s3-3" target="sqs3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="processor3" value="統一的 Log Processor (單一版本)&#xa;(Golang - 內建 Feature Flag 邏輯)&#xa;K8S Deployment with KEDA" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="175" y="530" width="350" height="90" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="sqs3" target="processor3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ff-controller" value="Feature Flag Controller&#xa;(程式內建開關)&#xa;&#xa;if (featureFlag.isEnabled(&quot;bloom_filter&quot;)) {&#xa;    useBloomFilter()  // 20%&#xa;} else {&#xa;    useOldRedis()     // 80%&#xa;}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=11;align=left;" parent="1" vertex="1">
          <mxGeometry x="140" y="680" width="420" height="110" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="processor3" target="ff-controller" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="old-redis3" value="舊版 Redis&#xa;(原有 data structure)&#xa;&#xa;80% 流量" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="50" y="850" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="new-redis3" value="新版 Redis&#xa;(Valkey 8.1 + Bloom Filter)&#xa;&#xa;20% 流量" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="450" y="850" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#009900;" parent="1" source="ff-controller" target="old-redis3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label3-1" value="80% 流量&#xa;(可動態調整)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontStyle=1;fontColor=#009900;" parent="arrow3-8" vertex="1" connectable="0">
          <mxGeometry x="-0.3" y="2" relative="1" as="geometry">
            <mxPoint x="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow3-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#0066cc;" parent="1" source="ff-controller" target="new-redis3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label3-2" value="20% 流量&#xa;(可動態調整)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontStyle=1;fontColor=#0066cc;" parent="arrow3-9" vertex="1" connectable="0">
          <mxGeometry x="-0.3" y="2" relative="1" as="geometry">
            <mxPoint x="20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="clickhouse3" value="ClickHouse (Analytics Database)&#xa;✅ 所有資料經過單一處理邏輯&#xa;✅ Global 去重有效" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="200" y="990" width="300" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="old-redis3" target="clickhouse3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="new-redis3" target="clickhouse3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rollout3" value=" 漸進式上線流程&lt;br&gt;&lt;br&gt;有問題立即設定回 0% (秒級切換)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="730" y="380" width="320" height="180" as="geometry" />
        </mxCell>
        <mxCell id="adv3" value="✅ 核心優勢&#xa;&#xa;• 精準的流量控制 (任意 %)&#xa;• 快速 Rollback (秒級)&#xa;• Global 去重完全有效&#xa;• 符合業界最佳實踐&#xa;• 無技術債累積&#xa;• 可複用於未來功能" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="730" y="590" width="320" height="150" as="geometry" />
        </mxCell>
        <mxCell id="tradeoff3" value="⚠️ 代價&lt;br&gt;&lt;br&gt;• 需要重新開發&lt;br&gt;• 需要完整測試與壓測&lt;br&gt;• 時程較方案二長" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" parent="1" vertex="1">
          <mxGeometry x="730" y="770" width="320" height="90" as="geometry" />
        </mxCell>
        <mxCell id="recommend3" value=" 最終建議&lt;br&gt;&lt;br&gt;&lt;br&gt;如果時程極度緊急：&lt;br&gt;→ 先用方案二快速驗證&lt;br&gt;→ 並行開發此方案&lt;br&gt;→ 驗證成功後立即切換" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="730" y="890" width="320" height="160" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
